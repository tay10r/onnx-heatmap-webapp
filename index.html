<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Artifact Sifter</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <meta name="theme-color" content="#111827" />

  <link rel="manifest" href="manifest.webmanifest" />
  <link rel="stylesheet" href="styles.css" />

  <!-- ONNX Runtime Web -->
  <script src="https://cdn.jsdelivr.net/npm/onnxruntime-web/dist/ort.min.js"></script>
</head>
<body>
  <div id="app">

    <!-- Phase 1: Model mgmt + captures -->
    <div id="phase-browse" class="phase active">
      <header class="app-header">
        <div>
          <h1>Artifact Sifter (v3)</h1>
          <p class="subtitle">Offline artifact detection</p>
        </div>
        <button id="btn-new-capture" class="btn primary">Capture New Sample</button>
      </header>

      <main class="main-layout">
        <!-- Models -->
        <section class="card">
          <h2>Models</h2>
          <div class="model-active">
            <span class="label">Active model:</span>
            <span id="active-model-name" class="value">None selected</span>
          </div>

          <ul id="model-list" class="list"></ul>

          <form id="model-add-form" class="model-form">
            <h3>Add model by URL</h3>
            <label>
              Name
              <input type="text" id="model-name-input" required />
            </label>
            <label>
              ONNX URL
              <input type="url" id="model-url-input" required />
            </label>
            <button type="submit" class="btn secondary fullwidth">Download & Save</button>
          </form>
        </section>

        <!-- Captures -->
        <section class="card">
          <h2>Captures</h2>
          <ul id="capture-list" class="list"></ul>
          <p id="capture-empty" class="empty-hint">No captures yet.</p>
        </section>
      </main>
    </div>

    <!-- Phase 2: Camera capture -->
    <div id="phase-capture" class="phase">
      <header class="app-header center">
        <h1>Align and Capture</h1>
      </header>
      <main class="capture-layout">
        <div class="camera-wrapper">
          <video id="camera-video" playsinline autoplay muted></video>
          <canvas id="camera-overlay" class="camera-overlay"></canvas>
          <div id="orientation-indicator" class="orientation-indicator">
            Hold device flat, pointing down
          </div>
        </div>
        <div class="capture-controls">
          <button id="btn-cancel-capture" class="btn ghost">Cancel</button>
          <button id="btn-do-capture" class="btn primary" disabled>Capture</button>
        </div>
      </main>
    </div>

    <!-- Phase 3: Processing -->
    <div id="phase-processing" class="phase">
      <div class="processing-center">
        <div class="spinner"></div>
        <p>Analyzing sample&hellip;</p>
      </div>
    </div>

    <!-- Viewer for a capture -->
    <div id="viewer-modal" class="modal hidden">
      <div class="modal-backdrop"></div>
      <div class="modal-content">
        <header class="modal-header">
          <h2 id="viewer-title">Capture</h2>
          <button id="viewer-close" class="icon-button" aria-label="Close">&times;</button>
        </header>
        <main class="modal-body">
          <div class="slider-container">
            <div class="slider-images">
              <img id="viewer-image" />
              <div id="viewer-heatmap-wrapper">
                <img id="viewer-heatmap" />
              </div>
            </div>
            <input id="viewer-slider" type="range" min="0" max="100" value="50" />
          </div>
          <div class="meta">
            <div><strong>Timestamp:</strong> <span id="viewer-ts"></span></div>
            <div><strong>Model:</strong> <span id="viewer-model"></span></div>
            <div><strong>GPS:</strong> <span id="viewer-gps"></span></div>
          </div>
        </main>
      </div>
    </div>

  </div>

  <script src="app.js"></script>
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', function () {
        navigator.serviceWorker.register('sw.js').catch(console.error);
      });
    }
  </script>
</body>
</html>

